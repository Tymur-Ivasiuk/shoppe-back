{% extends 'shop/base.html' %}
{% load static %}
{% load shop_tags %}

{% block css_styles %}
<link type="text/css" href="{% static 'shop/css/styles.css' %}" rel="stylesheet">
<link type="text/css" href="{% static 'shop/css/order.css' %}" rel="stylesheet">
{% endblock %}


{% block main %}
<main class="main">
    {% if can_view %}
        <section class="messages">
            <div class="added-cart message active-msg" id="yes-msg">
                <div class="first-added">
                    <img src="{% static 'shop/img/svg/main/messages/yes-icon.svg' %}" alt="yes" class="added-icon-message">
                    <p class="added-cart-message-text">
                        Weâ€™ve received your order
                    </p>
                </div>
            </div>
        </section>
        <div class="order-wrap">
            <div class="order-details">
                <h2 class="order-title">
                    Order Details
                </h2>
                <div class="order-details-wrap">
                    <div class="order-details-info">
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                ORDER NUMBER
                            </div>
                            <div class="order-details-info-desc">
                                {{ order.id }}
                            </div>
                        </div>
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                EMAIL
                            </div>
                            <div class="order-details-info-desc">
                                {{ order.email }}
                            </div>
                        </div>
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                CONTACT NUMBER
                            </div>
                            <div class="order-details-info-desc">
                                {{ order.phone }}
                            </div>
                        </div>
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                ORDER DATE
                            </div>
                            <div class="order-details-info-desc">
                                {{ order.time_create }}
                            </div>
                        </div>
                    </div>
                    <div class="order-details-info">
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                ORDER STATUS
                            </div>
                            <div class="order-details-info-desc">
                                {{ order.status }}
                            </div>
                        </div>
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                DELIVERY OPTIONS
                            </div>
                            <div class="order-details-info-desc">
                                Standard delivery
                            </div>
                        </div>
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                DELIVERY ADDRESS
                            </div>
                            <div class="order-details-info-desc">
                                {{order.country}} {{order.street}} {{order.postcode}} {{order.town}}
                            </div>
                        </div>
                        <div class="order-details-info-wrap">
                            <div class="order-details-info-title">
                                PAYMENT
                            </div>
                            <div class="order-details-info-desc">
                                {% if order.payment_status %}
                                    <i class="fa-sharp fa-solid fa-circle-check"></i> {{ order.payment_method }}
                                {% else %}
                                    <i class="fa-solid fa-circle-xmark"></i> {{ order.payment_method }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="order-summary">
                <h2 class="order-title">
                    Order Summary
                </h2>
                <div class="order-summary-info">
                    <div class="order-summary-info_header">
                        <div>
                            PRODUCT
                        </div>
                        <div>
                            TOTAL
                        </div>
                    </div>
                    <div class="order-summary-info_body">
                        {% for i in order.orderlist_set.all %}
                            <div class="order-summary-info_row">
                                <div>
                                    {{ i.product.title }}
                                </div>
                                <div>
                                     {{i.quantity}} x $ {{ i.price }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="order-summary-info_last-items">
                        <div class="order-summary-last-items-info_row">
                            <div>
                                SUBTOTAL
                            </div>
                            <div>
                                $ {{ order.orderlist_set.all|sum_subtotal }}
                            </div>
                        </div>
                        {% if order.sale %}
                            <div class="order-summary-last-items-info_row">
                                <div>
                                    SALE (-{{order.sale.sale_percent}}%)
                                </div>
                                <div style="color: rgb(210, 0, 0);">
                                    - $ {{ order.orderlist_set.all|sum_subtotal|sale:order.sale.sale_percent}}
                                </div>
                            </div>
                        {% endif %}
                        <div class="order-summary-last-items-info_row">
                            <div>
                                SHIPPING
                            </div>
                            <div>
                                $ {{ order.shipping_price }}
                            </div>
                        </div>
                    </div>
                    <div class="order-summary-info_footer">
                        <div class="order-summary-info_footer-row">
                            <div>
                                TOTAL
                            </div>
                            {% if request.session.cart|get_item:'sale' %}
                                <div>
                                    $ {{ order.orderlist_set.all|sum_subtotal|with_sale:order.sale.sale_percent|add:order.shipping_price }}
                                </div>
                            {% else %}
                                 <div>
                                    $ {{ order.orderlist_set.all|sum_subtotal|add:order.shipping_price }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="order-nothing">
            <h2 class="order-nothing-title">
                ERROR
            </h2>
            <p class="order-nothing-text">
                You have been denied viewing this order
            </p>
            <a href="{% url 'home' %}" class="order-nothing-link">
                <div class="order-nothing-link-button">
                    HOMEPAGE
                </div>
            </a>
        </div>
    {% endif %}
</main>
{% endblock %}

{% block js_scripts %}
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="{% static 'shop/js/messageOrder.js' %}"></script>
{% endblock %}